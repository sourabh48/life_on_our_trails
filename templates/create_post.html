{% extends "base.html" %}
{% load static %}

{% block content %}
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/create_post.css' %}">

    <div class="create-post-wrapper">
        <div class="create-post-card">

            <h2 class="create-post-title">Create New Post</h2>
            <p class="create-post-subtitle">
                Draft, schedule, and optimise posts with AI-assisted writing.
            </p>

            <form method="POST" enctype="multipart/form-data" id="post-create-form">
                {% csrf_token %}

                <!-- TITLE -->
                <div class="form-group">
                    <label class="field-label">Title</label>
                    {{ form.title }}
                    {% if form.title.errors %}
                        <small class="field-error">{{ form.title.errors.0 }}</small>
                    {% endif %}
                </div>

                <!-- CONTENT + AI TOOLBAR -->
                <div class="form-group">
                    <div class="field-label-row">
                        <label class="field-label">Content</label>
                        <div class="ai-toolbar">
                            <button type="button" class="ai-btn" id="ai-write-btn">✨ Draft from title</button>
                            <button type="button" class="ai-btn" id="ai-improve-btn">⚡ Improve writing</button>
                            <button type="button" class="ai-btn" id="ai-fix-btn">✅ Fix grammar</button>
                            <span class="ai-status" id="ai-status"></span>
                        </div>
                </div>

                    <div id="quill-editor"></div>
                <input type="hidden" name="content" id="content-input">

                    {% if form.content.errors %}
                        <small class="field-error">{{ form.content.errors.0 }}</small>
                    {% endif %}
                    <div id="content-error" style="color:#ff6b6b; margin-top:8px; display:none;"></div>
                </div>

                <!-- METRICS -->
                <div class="editor-metrics">
                    <div class="metrics-row">
                        <span><strong>Words:</strong> <span id="stat-words">0</span></span>
                        <span><strong>Reading time:</strong> <span id="stat-reading">0 min</span></span>
                        <span><strong>SEO Score:</strong> <span id="stat-seo-score">0</span>/100</span>
                    </div>
                    <div class="seo-bar-wrapper">
                        <div class="seo-bar-bg">
                            <div id="seo-bar-fill"></div>
                        </div>
                        <span id="seo-bar-label" class="seo-bar-label">
                        Too weak – add more detail, headings and description.
                    </span>
                    </div>
                    <div id="grammar-hints" class="grammar-hints"></div>
                </div>

                <!-- CATEGORY & TAGS -->
                <div class="row g-3 mt-3">
                    <div class="col-md-6">
                        <label class="field-label">Category</label>
                        {{ form.category }}
                        {% if form.category.errors %}
                            <small class="field-error">{{ form.category.errors.0 }}</small>
                        {% endif %}
                        <small class="helper-text">Or add a new category:</small>
                        {{ form.new_category }}
                    </div>

                    <div class="col-md-6">
                        <label class="field-label">Tags</label>

                        <div class="tag-manager">
                            <div class="tag-input-wrapper">
                                <div id="tag-chips" class="tag-chips"></div>

                                <label for="tag-input" class="visually-hidden">Search or create tags</label>
                                <input
                                        id="tag-input"
                                        type="text"
                                        class="tag-input"
                                        placeholder="Search or create tags..."
                                        autocomplete="off">

                                <div id="tag-suggest-box" class="tag-suggest-box"></div>
                            </div>

                            <input type="hidden" id="selected-tags" name="tags">
                            <input type="hidden" id="new-tags" name="new_tags">
                        </div>

                        {% if form.tags.errors %}
                            <small class="field-error">{{ form.tags.errors.0 }}</small>
                        {% endif %}
                    </div>
                </div>

                <!-- IMAGE -->
                <div class="form-group mt-3">
                    <label class="field-label">Featured Image</label>
                    {{ form.image }}
                    {% if form.image.errors %}
                        <small class="field-error">{{ form.image.errors.0 }}</small>
                    {% endif %}
                </div>

                <!-- STATUS -->
                <div class="status-panel mt-4">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-4">
                            <label class="field-label">Status</label>
                            {{ form.status }}
                        </div>
                        <div class="col-md-4" id="schedule-wrapper">
                            <label class="field-label">Publish at</label>
                            {{ form.publish_at }}
                            <small class="helper-text">For scheduled posts only.</small>
                        </div>
                        <div class="col-md-4 text-md-right">
                        <span class="status-hint" id="publish-lock-msg">
                            Status: Draft – you can save anytime.
                        </span>
                        </div>
                    </div>
                </div>

                <!-- SEO -->
                <div class="seo-panel mt-4">
                    <div class="seo-header">
                        <span class="seo-title">SEO Settings</span>
                        <span class="seo-pill">Optional</span>
                    </div>
                    <div class="row g-3 mt-2">
                        <div class="col-md-6">
                            <label class="field-label">Meta title</label>
                            {{ form.meta_title }}
                        </div>
                        <div class="col-md-6">
                            <label class="field-label">Meta description</label>
                            {{ form.meta_description }}
                        </div>
                    </div>
                </div>

                <!-- SUBMIT -->
                <div class="text-center mt-4">
                    <button type="submit" class="create-post-btn btn btn-primary">
                        Create Post
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
    <script src="{% static 'js/create_post.js' %}"></script>
{% endblock %}
